



<!DOCTYPE html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="RXJS文档">
      
      
      
        <meta name="author" content="Nosy">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.0">
    
    
      
        <title>创建操作符 - RXJS文档</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.78aab2dc.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="RXJS文档" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                RXJS文档
              </span>
              <span class="md-header-nav__topic">
                创建操作符
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/wohugb/rxjs-docs" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      wohugb/rxjs-docs
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." title="前言" class="md-tabs__link">
        前言
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../ReactiveX/intro/" title="响应式" class="md-tabs__link">
          响应式
        </a>
      
    </li>
  

      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../tutorial/basics/" title="教程" class="md-tabs__link">
          教程
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../observable/" title="概念" class="md-tabs__link">
          概念
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../pipeable-operators/" title="高级" class="md-tabs__link md-tabs__link--active">
          高级
        </a>
      
    </li>
  

      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    RXJS文档
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/wohugb/rxjs-docs" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      wohugb/rxjs-docs
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="前言" class="md-nav__link">
      前言
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      响应式
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        响应式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ReactiveX/intro/" title="ReactiveX" class="md-nav__link">
      ReactiveX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ReactiveX/Observable/" title="Observable(观察点)" class="md-nav__link">
      Observable(观察点)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ReactiveX/Operators/" title="Operators(观察者)" class="md-nav__link">
      Operators(观察者)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ReactiveX/Single/" title="Single(单)" class="md-nav__link">
      Single(单)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ReactiveX/Subject/" title="Subject(主体)" class="md-nav__link">
      Subject(主体)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ReactiveX/Scheduler/" title="Scheduler(调度程序)" class="md-nav__link">
      Scheduler(调度程序)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ReactiveX/tutorials/" title="教程" class="md-nav__link">
      教程
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../introduction/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../installation/" title="安装" class="md-nav__link">
      安装
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      教程
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        教程
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/basics/" title="基础" class="md-nav__link">
      基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/applications/" title="应用" class="md-nav__link">
      应用
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      概念
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        概念
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../observable/" title="Observable(观察点)" class="md-nav__link">
      Observable(观察点)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../observer/" title="Observer(观察者)" class="md-nav__link">
      Observer(观察者)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../subscription/" title="Subscription(订阅)" class="md-nav__link">
      Subscription(订阅)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../operators/" title="Operators(操作符)" class="md-nav__link">
      Operators(操作符)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../subject/" title="Subject(主体)" class="md-nav__link">
      Subject(主体)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../scheduler/" title="Scheduler(调度程序)" class="md-nav__link">
      Scheduler(调度程序)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      高级
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        高级
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../pipeable-operators/" title="Pipeable 操作符" class="md-nav__link">
      Pipeable 操作符
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../marble-testing/" title="编写弹珠测试" class="md-nav__link">
      编写弹珠测试
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../internal-marble-tests/" title="大理石测试" class="md-nav__link">
      大理石测试
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        创建操作符
      </label>
    
    <a href="./" title="创建操作符" class="md-nav__link md-nav__link--active">
      创建操作符
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#diy" title="为最终用户DIY自定义操作符" class="md-nav__link">
    为最终用户DIY自定义操作符
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" title="方针" class="md-nav__link">
    方针
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="例" class="md-nav__link">
    例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#observable" title="将运算符添加到Observable" class="md-nav__link">
    将运算符添加到Observable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" title="运算符作为纯函数" class="md-nav__link">
    运算符作为纯函数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="将您的操作员发布为单独的库" class="md-nav__link">
    将您的操作员发布为单独的库
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thislibrary" title="创建包含在ThisLibrary中的运算符" class="md-nav__link">
    创建包含在ThisLibrary中的运算符
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pr" title="为运营商提交PR" class="md-nav__link">
    为运营商提交PR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="内部子目录" class="md-nav__link">
    内部子目录
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../rxmarbles/" title="弹珠图" class="md-nav__link">
      弹珠图
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../other/" title="扩展学习" class="md-nav__link">
      扩展学习
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../maintainer-guidelines/" title="维护者指南" class="md-nav__link">
      维护者指南
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#diy" title="为最终用户DIY自定义操作符" class="md-nav__link">
    为最终用户DIY自定义操作符
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" title="方针" class="md-nav__link">
    方针
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="例" class="md-nav__link">
    例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#observable" title="将运算符添加到Observable" class="md-nav__link">
    将运算符添加到Observable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" title="运算符作为纯函数" class="md-nav__link">
    运算符作为纯函数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="将您的操作员发布为单独的库" class="md-nav__link">
    将您的操作员发布为单独的库
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thislibrary" title="创建包含在ThisLibrary中的运算符" class="md-nav__link">
    创建包含在ThisLibrary中的运算符
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pr" title="为运营商提交PR" class="md-nav__link">
    为运营商提交PR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="内部子目录" class="md-nav__link">
    内部子目录
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="_1">操作符创建<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p>There are many ways to create an operator for RxJS. In this version of RxJS, performance was the primary consideration, as such, operator creation
in a way that adheres to the existing structures in this library may not be straight forward. This is an attempt to document how to
create an operator either for yourself, or for this library.</p>
<p>For how to develop a custom operator for <em>this</em> library, <a href="#advanced">see below</a>.</p>
<h2 id="diy">为最终用户DIY自定义操作符<a class="headerlink" href="#diy" title="Permanent link">&para;</a></h2>
<h3 id="_2">方针<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>In the most common case, users might like to create an operator to be used only by their app. These can be developed in
any way the developer sees fit, but here are some guidelines:</p>
<ol>
<li><strong>Operators should always return an Observable</strong>. You're performing operations on unknown sets of things to create new sets.
  It only makes sense to return a new set. If you create a method that returns something other than an Observable, it's not an operator,
  and that's fine.</li>
<li><strong>Be sure to manage subscriptions</strong> created inside of the Observable your operator returns. Your operator is going to have to
  subscribe to the source (or <code>this</code>) inside of the returned Observable, be sure that it's returned as part of unsubscribe handler or
  subscription.</li>
<li><strong>Be sure to handle exceptions from passed functions</strong>. If you're implementing an operator that takes a function as an argument,
  when you call it, you'll want to wrap it in a <code>try/catch</code> and send the error down the <code>error()</code> path on the observable.</li>
<li><strong>Be sure to teardown scarce resources</strong> in your unsubscribe handler of your returned Observable. If you're setting up event handlers
  or a web socket, or something like that, the unsubscribe handler is a great place to remove that event handler or close that socket.</li>
</ol>
<h3 id="_3">例<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">mySimpleOperator</span><span class="p">(</span><span class="nx">someCallback</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">// We *could* do a `var self = this;` here to close over, but see next comment</span>
   <span class="k">return</span> <span class="nx">Observable</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">subscriber</span> <span class="p">=&gt;</span> <span class="p">{</span>
     <span class="c1">// because we&#39;re in an arrow function `this` is from the outer scope.</span>
     <span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

     <span class="c1">// save our inner subscription</span>
     <span class="kd">var</span> <span class="nx">subscription</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">value</span> <span class="p">=&gt;</span> <span class="p">{</span>
       <span class="c1">// important: catch errors from user-provided callbacks</span>
       <span class="k">try</span> <span class="p">{</span>
         <span class="nx">subscriber</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">someCallback</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
       <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">subscriber</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
       <span class="p">}</span>
     <span class="p">},</span>
     <span class="c1">// be sure to handle errors and completions as appropriate and</span>
     <span class="c1">// send them along</span>
     <span class="nx">err</span> <span class="p">=&gt;</span> <span class="nx">subscriber</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">),</span>
     <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">subscriber</span><span class="p">.</span><span class="nx">complete</span><span class="p">());</span>

     <span class="c1">// to return now</span>
     <span class="k">return</span> <span class="nx">subscription</span><span class="p">;</span>
   <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<h3 id="observable">将运算符添加到Observable<a class="headerlink" href="#observable" title="Permanent link">&para;</a></h3>
<p>There are a few ways to do this. It's really down to needs and preference:</p>
<p>1) Use the ES7 function bind operator (<code>::</code>) available in transpilers like <a href="http://babeljs.io">BabelJS</a>:</p>
<div class="codehilite"><pre><span></span><span class="nx">someObservable</span><span class="o">::</span><span class="nx">mySimpleOperator</span><span class="p">(</span><span class="nx">x</span> <span class="p">=&gt;</span> <span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;!&#39;</span><span class="p">);</span>
</pre></div>

<p>2) Create your own Observable subclass and override <code>lift</code> to return it:</p>
<div class="codehilite"><pre><span></span><span class="kr">class</span> <span class="nx">MyObservable</span> <span class="kr">extends</span> <span class="nx">Observable</span> <span class="p">{</span>
  <span class="nx">lift</span><span class="p">(</span><span class="nx">operator</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyObservable</span><span class="p">();</span> <span class="c1">//&lt;-- important part here</span>
    <span class="nx">observable</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">observable</span><span class="p">.</span><span class="nx">operator</span> <span class="o">=</span> <span class="nx">operator</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">observable</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// put it here .. or ..</span>
  <span class="nx">customOperator</span><span class="p">()</span> <span class="p">{</span>
    <span class="cm">/* do things and return an Observable */</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ... put it here...</span>
<span class="nx">MyObservable</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">mySimpleOperator</span> <span class="o">=</span> <span class="nx">mySimpleOperator</span><span class="p">;</span>
</pre></div>

<p>3) Patch <code>Observable.prototype</code> directly:</p>
<div class="codehilite"><pre><span></span><span class="nx">Observable</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">mySimpleOperator</span> <span class="o">=</span> <span class="nx">mySimpleOperator</span><span class="p">;</span>

<span class="c1">// ... and later .../</span>

<span class="nx">someObservable</span><span class="p">.</span><span class="nx">mySimpleOperator</span><span class="p">(</span><span class="nx">x</span> <span class="p">=&gt;</span> <span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;!&#39;</span><span class="p">);</span>
</pre></div>

<h3 id="_4">运算符作为纯函数<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>If you don't want to patch the Observable prototype, you can also write the operator as a pure function that takes the input Observable as argument, instead of relying on the <code>this</code> keyword.</p>
<p>Example implementation:</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">mySimpleOperator</span><span class="p">(</span><span class="nx">someCallback</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// notice that we return a function here</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">mySimpleOperatorImplementation</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Observable</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">subscriber</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">subscription</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">value</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="nx">subscriber</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">someCallback</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">subscriber</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">err</span> <span class="p">=&gt;</span> <span class="nx">subscriber</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">),</span>
      <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">subscriber</span><span class="p">.</span><span class="nx">complete</span><span class="p">());</span>

      <span class="k">return</span> <span class="nx">subscription</span><span class="p">;</span>
   <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>This can now be used with the <code>pipe()</code> method on the Observable:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">obs</span> <span class="o">=</span> <span class="nx">someObservable</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">mySimpleOperator</span><span class="p">(</span><span class="nx">x</span> <span class="p">=&gt;</span> <span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;!&#39;</span><span class="p">));</span>
</pre></div>

<h2 id="_5">将您的操作员发布为单独的库<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>We strongly recommend you to publish your custom operator as an npm package as a pure function to be used with <code>let</code>. See the sections above. RxJS core already has over 100 operators, and we should not add more operators unless they are absolutely essential and add functionality not possible with existing operators.</p>
<p>Publishing it as a separate library will guarantee your operator to be immediately usable by the community, and we can start growing an RxJS ecosystem as opposed to making the RxJS library thicker and heavier. There are cases, however, where the new operator should be added to the core library.</p>
<h2 id="thislibrary">创建包含在<em>This</em>Library中的运算符<a class="headerlink" href="#thislibrary" title="Permanent link">&para;</a></h2>
<p><strong>Please publish your operator as a separate library before proposing it into RxJS.</strong> See the section above.</p>
<p><strong>To create an operator for inclusion in this library, it's probably best to work from prior art</strong>. Something
like the <code>filter</code> operator would be a good start. It's not expected that you'll be able to read
this section and suddenly be an expert operator contributor.</p>
<p><strong>If you find yourself confused, DO NOT worry. Follow prior examples in the repo, submit a PR, and we'll work with you.</strong></p>
<p>Hopefully the information provided here will give context to decisions made while developing operators in this library.
There are a few things to know and (try to) understand while developing operators:</p>
<ol>
<li>All operator methods are actually created in separate modules from <code>Observable</code>. This is so developers can
 "build their own observable" by pulling in operator methods and adding them to observable in their own module.
 It also means operators can be brought in ad-hock and used directly, either with the ES7 function bind operator
 in Babel (<code>::</code>) or by using it with <code>.call()</code>.</li>
<li>Every operator has an <code>Operator</code> class. The <code>Operator</code> class is really a <code>Subscriber</code> "factory". It's
 what gets passed into the <code>lift</code> method to make the "magic" happen. It's sole job is to create the operation's
 <code>Subscriber</code> instance on subscription.</li>
<li>Every operator has a <code>Subscriber</code> class. This class does <em>all</em> of the logic for the operation. It's job is to
 handle values being nexted in (generally by overriding <code>_next()</code>) and forward it along to the <code>destination</code>,
 which is the next observer in the chain.</li>
<li>It's important to note that the <code>destination</code> Observer set on any <code>Subscriber</code> serves as more than just
   the destinations for the events passing through, If the <code>destination</code> is a <code>Subscriber</code> it also is used to set up
   a shared underlying <code>Subscription</code>, which, in fact, is also a <code>Subscriber</code>, and is the first <code>Subscriber</code> in the
   chain.</li>
<li>Subscribers all have <code>add</code> and <code>remove</code> methods that are used for adding and removing inner subscriptions to
   the shared underlying subscription.</li>
<li>When you <code>subscribe</code> to an Observable, the functions or Observer you passed are used to create the final <code>destination</code>
   <code>Subscriber</code> for the chain. It's this <code>Subscriber</code> that is really also the shared <code>Subscription</code> for the operator chain.</li>
</ol>
<h3 id="pr">为运营商提交PR<a class="headerlink" href="#pr" title="Permanent link">&para;</a></h3>
<p>Please complete these steps for each new operator added to RxJS as a pull request:</p>
<ul>
<li>Add the operator to Rx</li>
<li>It must have a <code>-spec.ts</code> tests file covering the canonical corner cases, with marble diagram tests</li>
<li>If possible, write a <code>asDiagram</code> test case too, for PNG diagram generation purposes</li>
<li>The spec file should have a type definition test at the end of the spec to verify type definition for various use cases</li>
<li>The operator must be documented in JSDoc style in the implementation file, including also the PNG marble diagram image</li>
<li>The operator should be listed in <code>doc/operators.md</code> in a category of operators</li>
<li>It should also be inserted in the operator decision tree file <code>doc/decision-tree-widget/tree.yml</code></li>
<li>You may need to update <code>MIGRATION.md</code> if the operator differs from the corresponding one in RxJS v4</li>
</ul>
<h3 id="_6">内部子目录<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>An "inner subscriber" or "inner subscription" is any subscription created inside of an operator's primary Subscriber. For example,
if you were to create your own "merge" operator of some sort, the Observables that are arriving on the source observable that you
want to "merge" will need to be subscribed to. Those subscriptions will be inner subscriptions. One interesting thing about
inner subscriptions in this library is that if you pass and set a <code>destination</code> on them, they will try to use that destination
for their <code>unsubscribe</code> calls. Meaning if you call <code>unsubscribe</code> on them, it might not do anything. As such, it's usually desireable
not to set the <code>destination</code> of inner subscriptions. An example of this might be the switch operators, that have a single underlying
inner subscription that needs to unsubscribe independent of the main subscription.</p>
<p>If you find yourself creating inner subscriptions, it might also be worth checking to see if the observable being passed <code>_isScalar</code>,
because if it is, you can pull the <code>value</code> out of it directly and improve the performance of your operator when it's operating over
scalar observables. For reference a scalar observable is any observable that has a single static value underneath it. <code>Observable.of('foo')</code> will
return a <code>ScalarObservable</code>, likewise, resolved <code>PromiseObservable</code>s will act as scalars.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../internal-marble-tests/" title="大理石测试" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                大理石测试
              </span>
            </div>
          </a>
        
        
          <a href="../rxmarbles/" title="弹珠图" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                弹珠图
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            版权 &copy; 2018 -  wohugb.github.io
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="http://wohugb.github.io" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/wohugb" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/wohugb" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/wohugb" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.8eb9be28.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../assets/javascripts/lunr/lunr.jp.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"0.17.3",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>